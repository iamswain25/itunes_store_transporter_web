#!/bin/bash

set -e

error()
{
    echo "$*" >&2
    exit 1
}

root=$(dirname "$0")
#action=${1:-work}
action=$1
padrino="${root}/padrino"

if [ ! -x "$padrino" ]; then
    error "$padrino is missing, please run the install script first: ruby setup.rb"
fi

case "$action" in
    jobs|notifications) # jobs:check task too?
	"$padrino" rake -c "$root/.." -e production "itmsworker:$action"
        ;;
    *)
        error "usage: itmsworker [jobs|notifications]"

esac
